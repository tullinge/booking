{% extends "base.html" %}
{% block title %} - Logga in{% endblock %}
{% block custom_head %}
{% include "student/google.html" %}
<style>
.footer div {
    text-align: center;
}
.g-signin2 {
    margin-left: auto;
    margin-right: auto;
}
</style>
{% endblock %}
{% block body %}
    <div class="content login-content">
        <h1 class="align-center">Tullinge Booking</h1>

        {% if fail %}
        <div class="alert alert-danger" role="alert">
            <p>{{ fail }}</p>
        </div>
        {% endif %}
    
        {% if success %}
        <div class="alert alert-success" role="alert">
            <p>{{ success }}</p>
        </div>
        {% endif %}
    
        <p>Du loggar in med ditt skolkonto.</p>

        <div class="g-signin2" data-onsuccess="onSignIn"></div>

        <script>
        function onSignIn(googleUser) {
            var id_token = googleUser.getAuthResponse().id_token;

            fetch('/callback', {
                method: 'POST',
                body: JSON.stringify({
                    idtoken: id_token
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(json) {
                console.log(json);

                if (json.status) {
                    window.location.replace("setup");
                } else {
                    signOut();
                    document.getElementById("message").value = json.message;
                    document.forms.errorRedirect.submit();
                }
            });
        }
        </script>

        <form id="errorRedirect" style="display: none;" method="POST" action="/callback/error">
            <input id="message" type="hidden" name="message" value="" />
        </form>
    </div>
{% endblock %}

